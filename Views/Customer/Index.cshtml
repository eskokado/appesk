@model List<CustomerModel>

<h4>Consulte os seus Clientes cadastrados na sua Loja ou realize o cadastro de novos Clientes</h4>
<p>
    <a href="@Url.Action("Create", "Customer")" class="btn btn-primary">Adicionar Cliente</a>
</p>

<div id="filterSection">
  <h4 class="filter-heading">
    <i id="iconeFilter" class="fas fa-chevron-up"></i> Filtrar Compradores
  </h4>
  <div id="filterFormDiv" class="@(ViewBag.IsFilter ? "collapse show" : "collapse")">
    <form id="filterForm" method="post" action="@Url.Action("Index", "Customer")">
        <input type="hidden" id="isFilter" name="isFilter" value="false" />

        <div class="form-group">
            <label for="name">Nome/Razão Social:</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Nome ou Razão Social do Cliente">
        </div>
        <div class="form-group">
            <label for="email">E-mail:</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="E-mail do Cliente">
        </div>
        <div class="form-group">
            <label for="phone">Telefone:</label>
            <input type="tel" class="form-control" id="phone" name="phone" placeholder="Telefone do Cliente">
        </div>
        <div class="form-group">
            <label for="registrationDate">Data de Cadastro:</label>
            <input type="date" class="form-control" id="registrationDate" name="registrationDate" placeholder="Selecione uma data ou período">
        </div>
        <div class="form-group">
            <label for="isBlocked">Cliente bloqueado:</label>
            <select class="form-control" id="isBlocked" name="isBlocked">
                <option value="">-- Selecione --</option>
                <option value="true">SIM</option>
                <option value="false">NÃO</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary" onclick="removeShowClass();setFilterFlag()">Filtrar</button>
        <button type="button" class="btn btn-secondary" onclick="clearFilters()">Limpar filtros</button>
    </form>
  </div>
</div>

<div id="customerList">
    <h4>Lista de Compradores</h4>
    <div id="customerGrid">
        <table class="table">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" id="selectAll" />
                    </th>
                    <th>Nome/Razão Social</th>
                    <th>E-mail</th>
                    <th>Telefone</th>
                    <th>Data de Cadastro</th>
                    <th>Bloqueado</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var customer in Model)
                {
                    <tr>
                        <td>
                            <input type="checkbox" class="selectRow" />
                        </td>
                        <td>@customer.Name</td>
                        <td>@customer.Email</td>
                        <td>@customer.Phone</td>
                        <td>@customer.RegistrationDate.ToString("dd/MM/yyyy")</td>
                        <td>
                            <input type="checkbox" class="isBlockedCheckbox" @(customer.IsBlocked ? "checked" : "") disabled />
                        </td>
                        <td>
                            <a href="@Url.Action("Edit", "Customer", new { id = customer.Id })" class="btn btn-primary">Editar</a>
                            <a class='btn btn-danger' onclick="DisplayConfirmDeleteModal('@customer.Id')" >Deletar</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteModalLabel">Confirme Deletar</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="CustomerIdDelete" class="form-control" />
        <p>Deseja mesmo apagar este cliente?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button id="btnDelete" type="button" class="btn btn-danger">Deletar</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function(){
            $("#btnDelete").on("click", function(){
                let CustomerId = $("#CustomerIdDelete").val();
                let UrlHandler="/Customer/Delete/"+CustomerId;
                $.ajax({
                    url: UrlHandler, 
                    type: 'GET',
                    success: function() {
                        location.href = location.href;
                    }
                });
            });
        });

        document.addEventListener("DOMContentLoaded", function() {
            const filterHeading = document.querySelector(".filter-heading");
            const filterFormDiv = document.getElementById("filterFormDiv");
            let iconeFilter = document.getElementById("iconeFilter");

            filterHeading.addEventListener("click", function() {
                filterHeading.classList.toggle("expanded");
                filterFormDiv.classList.toggle("show");
                iconeFilter.classList.toggle("fa-chevron-down");
                iconeFilter.classList.toggle("fa-chevron-up");
            });
        });

        function removeShowClass() {
            const filterFormDiv = document.getElementById("filterFormDiv");
            let iconeFilter = document.getElementById("iconeFilter");
            filterFormDiv.classList.remove("show");
            document.getElementById("isFilter").value = "false";
            iconeFilter.classList.remove("fa-chevron-up");
            iconeFilter.classList.add("fa-chevron-down");
        }

        function setFilterFlag() {
            event.preventDefault();
            document.getElementById("isFilter").value = "true";
        }

        function clearFilters() {
        }

        function DisplayConfirmDeleteModal(CustomerId) {
            $("#CustomerIdDelete").val(CustomerId);
            $("#deleteModal").modal('show');
        }
        window.DisplayConfirmDeleteModal = DisplayConfirmDeleteModal;
    </script>
}
